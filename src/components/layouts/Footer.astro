---
import AnyIcon from "../common/AnyIcon.astro";
import cv from "../../config/cv.json";
const { socialLinks, basic } = (cv as any);
import type { Locale } from "../../i18n/ui";
import { t } from "../../i18n/ui";
const locale: Locale = Astro.url.pathname.startsWith('/fr') ? 'fr' : 'en';
// Year (safe without relying on TS lib typings)
const DateCtor: any = (globalThis as any)?.Date;
const currentYear = DateCtor ? new DateCtor().getFullYear() : 2025;

// Social list (precompute once; simple and easy to edit)
const socialList: any[] = ((globalThis as any)?.Array?.isArray(socialLinks)) ? (socialLinks as any[]) : [];
---

<footer class="mt-12 bg-background">
        <div class="px-4 mx-auto sm:px-6 lg:px-8 max-w-7xl">
    <!-- Top gradient bar (match width with grey line/container) -->
    <div class="h-2 w-full" style={`background: linear-gradient(90deg, var(--color-secondary), var(--color-primary));`}></div>
        <div class="py-10 md:py-14 grid grid-cols-1 md:grid-cols-3 gap-10">
        <!-- Left: Name and bio -->
            <div class="flex flex-col items-center text-center">
                        <h3 class="text-2xl font-bold retro-title">{basic?.name}</h3>
                        <p class="mt-3 text-sm text-offset">{(locale === 'en' ? basic?.locales?.en?.job : basic?.job) ?? basic?.job}</p>
                                        <p class="mt-3 text-sm">{t(locale, 'footerBlurb', 'Practical notes on DevOps, Cloud, and modern software delivery.')}</p>
                    </div>

            <!-- Middle: Connect social icons (centered) -->
            <div class="flex flex-col items-center text-center">
                <h4 class="text-lg font-semibold">{t(locale, 'connect', 'Connect')}</h4>
                <div class="mt-4 flex items-center justify-center gap-4">
                    {(() => {
                        const A: any = socialList as any;
                        const L = (A && typeof A.length === 'number') ? A.length : 0;
                        const nodes: any = [] as any;
                        for (let i = 0; i < L; i++) {
                            const s: any = A[i];
                            (nodes as any).push(
                                <a href={s.link} target="_blank" rel="noopener noreferrer" class="p-2 rounded hover:bg-background-offset focus:bg-background-offset" aria-label={s.iconName}>
                                    <AnyIcon name={s.iconName} class="size-6" />
                                </a>
                            );
                        }
                        return nodes as any;
                    })()}
                </div>
            </div>

            <!-- Right: Quick Links (centered) -->
                    <div class="flex flex-col items-center text-center">
                        <h4 class="text-lg font-semibold">{t(locale, 'quickLinks', 'Quick Links')}</h4>
                        {(() => {
                            const isFR = Astro.url.pathname.startsWith('/fr');
                            const homeHref = isFR ? '/fr/' : '/';
                            const aboutHref = isFR ? '/fr/about' : '/about';
                            // Temporarily point Blog to local 404 placeholder while blog isn't live
                            const blogHref = '/404';
                            return (
                                <ul class="mt-4 space-y-2 text-center">
                                    <li><a href={homeHref} class="hover:text-offset">{t(locale, 'home', 'Home')}</a></li>
                                    <li><a href={blogHref} class="hover:text-offset">{t(locale, 'blog', 'Blog')}</a></li>
                                    <li><a href={aboutHref} class="hover:text-offset">{t(locale, 'about', 'About')}</a></li>
                                </ul>
                            );
                        })()}
                    </div>
        </div>

        <hr class="border-border" />

        <div class="py-6 md:py-8 flex items-center justify-center gap-6 text-sm text-center">
            <p class="text-offset">Â© {currentYear} {basic?.name}. All rights reserved.</p>
            <span class="flex items-center gap-2 text-offset">
                <span>Visites:</span>
                <span style="display:inline-block;vertical-align:middle;margin:0;padding:0;">
                    <script type="text/javascript" id="servicewb_158436">
                    (function() {
                    var cv = document.createElement("script"); cv.type = "text/javascript"; cv.async = true;
                    cv.src = "https://www.compteur-visite.com/service.php?v=1.1&id=158436&k=a7593608d96d79246e8e8384b2c869a1&c="+document.cookie;
                    var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(cv, s);
                    })();
                    </script>
                    <img src="https://www.compteur-visite.com/service.php?v=1.1&id=158436&k=a7593608d96d79246e8e8384b2c869a1" alt="Visites" style="display:inline-block;margin:0;padding:0;border:0;vertical-align:middle;" />
                    <noscript><a href="https://www.compteur-visite.com/">Services gratuits pour webmasters</a></noscript>
                </span>
            </span>
            <p class="italic text-offset">
                Building the future, one line of code at a time
                <a href="/health" class="hover:text-primary ml-1" aria-label="Health page">ðŸš€</a>
            </p>
        </div>
    </div>
</footer>
